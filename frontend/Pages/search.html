<!-- ============================================
     LearnHub - Search Students Page (search.html)
     ============================================
     This page provides comprehensive search functionality for finding students.
     It includes both form-based search and live search capabilities.

     Features:
     - Search form with text input and submit button
     - Live search functionality with debouncing
     - AJAX-powered search results
     - Results table with student information
     - Export functionality for search results
     - Clear results functionality
     - Font Awesome icons for visual elements
     - Bootstrap responsive layout
     - JavaScript for search handling and table management

     Dependencies:
     - Bootstrap 5.1.3 for layout and components
     - Font Awesome 6.0.0 for icons
     - Custom CSS (styles.css) for styling
     - Custom JavaScript (scripts.js) for interactions

     Search Capabilities:
     - Search by name, ID, email, or course
     - Real-time search suggestions
     - AJAX-powered backend integration
     - Results pagination and filtering
     - CSV export functionality

     API Endpoints:
     - POST /search: Form-based search
     - GET /api/search: Live search suggestions
     ============================================ -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Document metadata and character encoding -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LearnHub - Search Students</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/LearnHub.png') }}"
      type="image/png"
    />
    <!-- External CSS Dependencies -->
    <!-- Font Awesome for search and table icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Bootstrap for responsive layout and components -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS for search page styling -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <!-- ============================================
         NAVIGATION BAR
         ============================================
         Main navigation with LearnHub branding and menu items.
         Search link is marked as active to show current page.
         ============================================ -->
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container">
        <!-- Brand logo and home link -->
        <a class="navbar-brand" href="/">
          <i class="fas fa-graduation-cap me-2"></i> LearnHub
        </a>
        <!-- Mobile menu toggle -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Navigation menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <!-- Home link -->
            <li class="nav-item">
              <a class="nav-link" href="/"
                ><i class="fas fa-home me-1"></i> Home</a
              >
            </li>
            <!-- Dashboard link -->
            <li class="nav-item">
              <a class="nav-link" href="dashboard"
                ><i class="fas fa-tachometer-alt me-1"></i> Dashboard</a
              >
            </li>
            <!-- Add Student link -->
            <li class="nav-item">
              <a class="nav-link" href="add"
                ><i class="fas fa-user-plus me-1"></i> Add</a
              >
            </li>
            <!-- View Students link -->
            <li class="nav-item">
              <a class="nav-link" href="view"
                ><i class="fas fa-users me-1"></i> View</a
              >
            </li>
            <!-- Search Students link (active) -->
            <li class="nav-item">
              <a class="nav-link active" href="search"
                ><i class="fas fa-search me-1"></i> Search</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- ============================================
         SEARCH STUDENTS CONTENT
         ============================================
         Main content area with search form and results display.
         Includes search functionality and results management.
         ============================================ -->
    <div class="container mt-4">
      <!-- Page title -->
      <h2 class="mb-4">Search Students</h2>

      <!-- Main search card -->
      <div class="card">
        <div class="card-body">
          <!-- ============================================
               SEARCH FORM SECTION
               ============================================
               Form for submitting search queries to the backend.
               Includes input field and search button with validation.
               ============================================ -->
          <form id="search-form" method="POST" class="mb-4">
            <div class="form-group">
              <label for="query" class="form-label"
                >Search by name, ID, email, or course</label
              >
              <div class="input-group">
                <!-- Search input field -->
                <input
                  type="text"
                  class="form-control"
                  id="query"
                  name="query"
                  placeholder="Enter search term..."
                  required
                />
                <!-- Search submit button -->
                <button class="btn btn-primary" type="submit">
                  <i class="fas fa-search"></i> Search
                </button>
              </div>
            </div>
          </form>

          <!-- ============================================
               SEARCH RESULTS SECTION
               ============================================
               Container for displaying search results.
               Initially hidden, shown when results are available.
               ============================================ -->
          <div id="search-results-section" class="mt-4" style="display: none">
            <!-- Results header with count -->
            <h5 class="mb-3">
              <i class="fas fa-table me-2"></i>Search Results
              <span id="results-count" class="badge bg-primary ms-2">0</span>
            </h5>

            <!-- Results table container -->
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <!-- Table header with column icons -->
                <thead class="table-dark">
                  <tr>
                    <th><i class="fas fa-id-card me-1"></i>Student ID</th>
                    <th><i class="fas fa-user me-1"></i>Name</th>
                    <th><i class="fas fa-birthday-cake me-1"></i>Age</th>
                    <th><i class="fas fa-envelope me-1"></i>Email</th>
                    <th><i class="fas fa-book me-1"></i>Courses</th>
                    <th><i class="fas fa-cogs me-1"></i>Actions</th>
                  </tr>
                </thead>
                <!-- Table body for results -->
                <tbody id="results-table-body"></tbody>
              </table>
            </div>

            <!-- Results footer with controls -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <!-- Results count display -->
              <small class="text-muted">
                Showing <span id="showing-count">0</span> of
                <span id="total-count">0</span> results
              </small>
              <!-- Action buttons -->
              <div>
                <!-- Export results button (hidden by default) -->
                <button
                  id="export-results-btn"
                  class="btn btn-sm btn-outline-success me-2"
                  style="display: none"
                >
                  <i class="fas fa-download me-1"></i>Export CSV
                </button>
                <!-- Clear results button -->
                <button
                  id="clear-results-btn"
                  class="btn btn-sm btn-outline-secondary"
                >
                  <i class="fas fa-times me-1"></i>Clear Results
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================
         NOTIFICATION ELEMENT
         ============================================
         Toast notification system for user feedback.
         Used for search results and error messages.
         ============================================ -->
    <div id="notification" class="notification">
      <div class="d-flex align-items-center">
        <i class="fas fa-check-circle"></i>
        <span id="notification-message"></span>
      </div>
    </div>

    <!-- ============================================
         FOOTER SECTION
         ============================================
         Site footer with copyright, social links, and developer credits.
         ============================================ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 LearnHub | All Rights Reserved</p>
        <div class="social-icons">
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
        <p>@Paul Mulilo And The LearnHub Team</p>
      </div>
    </footer>

    <!-- ============================================
         SCRIPTS SECTION
         ============================================
         JavaScript libraries and search-specific functionality.
         ============================================ -->
    <!-- Bootstrap JavaScript for interactive components -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript for search functionality -->
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
    <script>
      // ============================================
      // SEARCH PAGE JAVASCRIPT INITIALIZATION
      // ============================================
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize search functionality
        setupSearch();
        setupTableResults();
        setupDeleteButtons();
        setupNotification();

        // ============================================
        // SEARCH FORM SUBMISSION HANDLER
        // ============================================
        // Handle form submission for search queries
        const searchForm = document.getElementById("search-form");
        const searchInput = document.getElementById("query");
        const resultsSection = document.getElementById(
          "search-results-section"
        );
        const resultsTableBody = document.getElementById("results-table-body");
        const resultsCount = document.getElementById("results-count");

        searchForm.addEventListener("submit", function (e) {
          e.preventDefault();

          const query = searchInput.value.trim();
          if (!query) {
            return;
          }

          // Show loading state
          resultsTableBody.innerHTML =
            '<tr><td colspan="6" class="text-center">Searching...</td></tr>';
          resultsSection.style.display = "block";

          // Make AJAX request to search endpoint
          fetch("/search", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "query=" + encodeURIComponent(query),
          })
            .then((response) => response.text())
            .then((html) => {
              // Parse HTML response to extract results
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const newResultsTable = doc.getElementById("results-table-body");

              if (newResultsTable) {
                resultsTableBody.innerHTML = newResultsTable.innerHTML;
                resultsCount.textContent = newResultsTable.children.length;
              } else {
                resultsTableBody.innerHTML =
                  '<tr><td colspan="6" class="text-center">No results found</td></tr>';
                resultsCount.textContent = "0";
              }
            })
            .catch((error) => {
              console.error("Search error:", error);
              resultsTableBody.innerHTML =
                '<tr><td colspan="6" class="text-center text-danger">Error occurred while searching</td></tr>';
            });
        });

        // ============================================
        // LIVE SEARCH FUNCTIONALITY
        // ============================================
        // Real-time search as user types in search field
        searchInput.addEventListener("input", function () {
          const query = this.value.trim();

          if (query.length < 2) {
            return;
          }

          // Debounce search requests to avoid excessive API calls
          clearTimeout(this.searchTimeout);
          this.searchTimeout = setTimeout(() => {
            fetch(`/api/search?q=${encodeURIComponent(query)}`)
              .then((res) => res.json())
              .then((data) => {
                // Display live search results
                if (data.results && data.results.length > 0) {
                  resultsTableBody.innerHTML = data.results
                    .map(
                      (student) => `
                    <tr>
                      <td>${student.student_id}</td>
                      <td>${student.name}</td>
                      <td>${student.age}</td>
                      <td>${student.email}</td>
                      <td>${student.courses}</td>
                      <td>
                        <a href="/view_student/${student.id}" class="btn btn-sm btn-info">View</a>
                        <a href="/edit_student/${student.id}" class="btn btn-sm btn-warning">Edit</a>
                      </td>
                    </tr>
                  `
                    )
                    .join("");
                  resultsSection.style.display = "block";
                  resultsCount.textContent = data.results.length;
                }
              })
              .catch((err) => console.error("Live search error:", err));
          }, 300); // 300ms debounce delay
        });
      });
    </script>
  </body>
</html>
